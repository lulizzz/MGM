{"createdAt":"2024-07-19T16:53:54.041Z","updatedAt":"2024-07-19T17:34:50.151Z","id":"4pCoHjGYVXLTNanj","name":"MGM2 - commands","active":false,"nodes":[{"parameters":{},"id":"b531df2b-01b7-44cb-a7b0-2c473002bc10","name":"Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[220,280]},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/chat/completions","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"gpt-4o-mini\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"Entenda o contexto do texto da imagem. Você precisa fazer a tradução desse texto para pt-br, respeitando a formatação. Use *negrito* para títulos\"\n        },\n        {\n          \"type\": \"image_url\",\n          \"image_url\": {\n            \"url\": \"data:image/jpeg;base64,{{ $('Execute Workflow Trigger').item.json[\"quoted_image\"] }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"max_tokens\": 300\n}\n","options":{}},"id":"e1c6282d-1509-4a1d-80bf-396d7d299b11","name":"Vision - gpt-4o1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[980,20],"credentials":{"openAiApi":{"id":"neTK4UBDC4tLBdAV","name":"G4 educação"}}},{"parameters":{"operation":"update","tableId":"statistics","matchType":"allFilters","filters":{"conditions":[{"keyName":"whatsapp","condition":"eq","keyValue":"={{ $('variaveis').item.json.whatsapp }}"},{"keyName":"chat_id","condition":"eq","keyValue":"={{ $('variaveis').item.json.grupo.split(\"@\")[0] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"group_name","fieldValue":"={{ $('get_group_info').item.json.subject }}"},{"fieldId":"messages","fieldValue":"={{ $('Supabase - busca linha estatistica').item.json.messages + 1 }}"},{"fieldId":"name","fieldValue":"={{ $('variaveis').item.json.name }}"}]}},"id":"231aa03b-4b5e-461f-b0ee-0dafc0a3e125","name":"Supabase22","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1620,-280],"credentials":{"supabaseApi":{"id":"CbWcX4JfjQ9TjSRA","name":"MGM"}}},{"parameters":{"tableId":"interactions","fieldsUi":{"fieldValues":[{"fieldId":"whatsapp","fieldValue":"={{ $('variaveis').item.json.whatsapp }}"},{"fieldId":"message","fieldValue":"={{ $('variaveis').item.json.user_message }}{{ $json.choices[0].message.content }}"},{"fieldId":"chat_id","fieldValue":"={{ $('variaveis').item.json.grupo.split(\"@\")[0] }}"},{"fieldId":"group_name","fieldValue":"={{ $('get_group_info').item.json.subject }}"},{"fieldId":"user_name","fieldValue":"={{ $('variaveis').item.json.name }}"},{"fieldId":"response_to","fieldValue":"={{ $('Supabase1 - id resposta').item.json.message }}"},{"fieldId":"message_id","fieldValue":"={{ $('Webhook').item.json.body.data.key.id }}"}]}},"id":"0b7a8fcc-4d2b-48c8-9b53-f61fa8177c8d","name":"Supabase9","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1440,-280],"credentials":{"supabaseApi":{"id":"CbWcX4JfjQ9TjSRA","name":"MGM"}}},{"parameters":{"operation":"getAll","tableId":"interactions","limit":1,"filters":{"conditions":[{"keyName":"message_id","condition":"eq","keyValue":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage.contextInfo.stanzaId ? $('Webhook').item.json.body.data.message.extendedTextMessage.contextInfo.stanzaId : ($('Webhook').item.json.body.data.message.reactionMessage.key.id ? $('Webhook').item.json.body.data.message.reactionMessage.key.id : $('Webhook').item.json.body.data.message.audioMessage.contextInfo.stanzaId) }} "}]}},"id":"b76512d3-a067-4034-9df1-f7637f5e6e03","name":"Supabase1 - id resposta1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1180,-280],"alwaysOutputData":true,"notesInFlow":true,"credentials":{"supabaseApi":{"id":"CbWcX4JfjQ9TjSRA","name":"MGM"}},"notes":"puxa a mensagem respondida (se houver)"},{"parameters":{"url":"=https://api.sincronia.digital/group/findGroupInfos/{{ $('variaveis').item.json.instance_evolution }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"groupJid","value":"={{ $('variaveis').item.json.grupo }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"db654859-c956-4042-a380-38d1402c372d","name":"get_group_info1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[960,-280],"notesInFlow":true,"credentials":{"httpHeaderAuth":{"id":"zCSxMXgLLp3Ga6ET","name":"Evolution-apikey"}},"notes":"puxa info do grupo"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.user_message }}","rightValue":"!transl","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"!translate"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"81da0563-4b9d-41b8-a8c0-9805796ce628","leftValue":"={{ $json.user_message }}","rightValue":"!tradu","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"renameOutput":true,"outputKey":"!tradução"}]},"options":{}},"id":"d7fbabe3-e995-47f7-9249-3f968c12c3dc","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3,"position":[420,280]},{"parameters":{"method":"POST","url":"=https://api.sincronia.digital/message/sendText/{{ $('Webhook').item.json.body.data.owner }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Execute Workflow Trigger').item.json.grupo }}"},{"name":"textMessage.text","value":"={{ $json.choices[0].message.content }}"},{"name":"options.quoted.key","value":"={{ $('Execute Workflow Trigger').item.json.message_id }}"}]},"options":{"response":{"response":{"neverError":true}}}},"id":"1821e06b-a183-4d05-b3d9-d2aa5fa768f8","name":"msg_stats1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1160,20],"credentials":{"httpHeaderAuth":{"id":"zCSxMXgLLp3Ga6ET","name":"Evolution-apikey"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $('Execute Workflow Trigger').item.json.quoted_image }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"image"}]},"options":{}},"id":"930db494-8392-48cc-803d-2dc39bd83d90","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":3,"position":[640,-100]}],"connections":{"Vision - gpt-4o1":{"main":[[{"node":"msg_stats1","type":"main","index":0}]]},"Supabase9":{"main":[[{"node":"Supabase22","type":"main","index":0}]]},"get_group_info1":{"main":[[{"node":"Supabase1 - id resposta1","type":"main","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[],[{"node":"Vision - gpt-4o1","type":"main","index":0}]]},"Switch1":{"main":[[]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Execute Workflow Trigger":[{"json":{"whatsapp":"5519994317797","user_message":"!tradução\n","instance_id":"bu9qnq7ga1eo7085dc9w6","msg_sent":"2024-07-19T14:33:04.145Z","assistant_id":"asst_z7suvl0dVsf5rNWeicAjt475","Developer_Key":"AIzaSyBzYmCjdHAkg4X9GJKqthauxGJCUg6K71o","name":"Luiz | Sincron IA","assistant_version":"v1","msg_type":"messages.upsert","msg_channel_type":null,"grupo":"120363302353017297","instance_evolution":"Sincron","message_id":"93883F8AE67982D00A","imagem_url":null,"whats_participante":"5519994317797","img_base64":null,"tipo":"text","tipoMidia":"extendedTextMessage","message_link":null,"title_link":null,"description_link":null,"response_to":null,"":""}}]},"versionId":"fa6b6043-100e-420b-81e8-99cd887828d2","triggerCount":0,"tags":[]}